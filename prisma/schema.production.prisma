generator client {
  provider      = "prisma-client-js"
  output        = "../src/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
  @@map("verificationtokens")
}

model User {
  id                String                  @id @default(cuid())
  name              String?
  email             String                  @unique
  emailVerified     DateTime?               @map("email_verified")
  image             String?
  password          String?
  phone             String?
  role              UserRole                @default(PROFESOR)
  isActive          Boolean                 @default(true) @map("is_active")
  parentRole        String?                 @map("parent_role")
  status            UserStatus?             @default(ACTIVE)
  provider          String?
  isOAuthUser       Boolean                 @default(false) @map("is_oauth_user")
  createdAt         DateTime                @default(now()) @map("created_at")
  updatedAt         DateTime                @updatedAt @map("updated_at")
  accounts          Account[]
  eventTemplates    CalendarEventTemplate[]
  authoredEvents    CalendarEvent[]         @relation("CalendarEventAuthor")
  meetings          Meeting[]
  uploadedPhotos    Photo[]                 @relation("PhotoUploader")
  planningDocuments PlanningDocument[]
  sessions          Session[]
  uploadedVideos    Video[]                 @relation("VideoUploader")
  votes             VoteResponse[]          @relation("UserVotes")
  attendingEvents   CalendarEvent[]         @relation("CalendarEventAttendees")

  @@map("users")
}

model PlanningDocument {
  id          String   @id @default(cuid())
  title       String
  content     String
  subject     String
  grade       String
  authorId    String   @map("author_id")
  attachments Json?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([subject])
  @@index([grade])
  @@index([updatedAt])
  @@map("planning_documents")
}

model SchoolInfo {
  id        String   @id @default(cuid())
  name      String
  mission   String
  vision    String
  address   String
  phone     String
  email     String
  website   String
  logoUrl   String?  @map("logo_url")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("school_info")
}

model TeamMember {
  id          String   @id @default(cuid())
  name        String
  title       String
  description String
  specialties Json
  imageUrl    String?  @map("image_url")
  order       Int      @default(0)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("team_members")
}

model Meeting {
  id               String        @id @default(cuid())
  title            String
  description      String?
  studentName      String        @map("student_name")
  studentGrade     String        @map("student_grade")
  guardianName     String        @map("guardian_name")
  guardianEmail    String        @map("guardian_email")
  guardianPhone    String        @map("guardian_phone")
  scheduledDate    DateTime      @map("scheduled_date")
  scheduledTime    String        @map("scheduled_time")
  duration         Int           @default(30)
  location         String        @default("Sala de Reuniones")
  status           MeetingStatus @default(SCHEDULED)
  type             MeetingType   @default(PARENT_TEACHER)
  assignedTo       String        @map("assigned_to")
  notes            String?
  outcome          String?
  followUpRequired Boolean       @default(false) @map("follow_up_required")
  attachments      Json?
  source           MeetingSource @default(STAFF_CREATED)
  reason           String?
  parentRequested  Boolean       @default(false) @map("parent_requested")
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  teacher          User          @relation(fields: [assignedTo], references: [id])

  @@index([assignedTo])
  @@index([scheduledDate])
  @@index([status])
  @@index([source])
  @@index([parentRequested])
  @@map("meetings")
}

model MeetingTemplate {
  id          String      @id @default(cuid())
  name        String
  description String?
  duration    Int         @default(30)
  type        MeetingType
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  @@map("meeting_templates")
}

model CalendarEvent {
  id             String          @id @default(cuid())
  title          String
  description    String?
  startDate      DateTime        @map("start_date")
  endDate        DateTime        @map("end_date")
  category       EventCategory
  priority       EventPriority   @default(MEDIUM)
  level          String          @default("both")
  isRecurring    Boolean         @default(false) @map("is_recurring")
  isAllDay       Boolean         @default(false) @map("is_all_day")
  color          String?
  location       String?
  isActive       Boolean         @default(true) @map("is_active")
  attachments    String?
  metadata       String?
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  createdBy      String          @map("created_by")
  updatedBy      String          @map("updated_by")
  version        Int             @default(1)
  author         User            @relation("CalendarEventAuthor", fields: [createdBy], references: [id], onDelete: Cascade)
  recurrenceRule RecurrenceRule?
  attendees      User[]          @relation("CalendarEventAttendees")

  @@index([startDate])
  @@index([endDate])
  @@index([category])
  @@index([priority])
  @@index([isActive])
  @@index([createdBy])
  @@index([startDate, endDate, category, isActive], map: "idx_calendar_events_date_category")
  @@index([createdBy, category, isActive], map: "idx_calendar_events_author_role")
  @@index([isRecurring, startDate], map: "idx_calendar_events_recurrence")
  @@index([priority, startDate, isActive], map: "idx_calendar_events_priority_date")
  @@map("calendar_events")
}

model RecurrenceRule {
  id              String            @id @default(cuid())
  calendarEventId String            @unique @map("calendar_event_id")
  pattern         RecurrencePattern
  interval        Int               @default(1)
  daysOfWeek      String            @default("") @map("days_of_week")
  monthOfYear     Int?              @map("month_of_year")
  weekOfMonth     Int?              @map("week_of_month")
  endDate         DateTime?         @map("end_date")
  occurrences     Int?
  exceptions      String            @default("")
  calendarEvent   CalendarEvent     @relation(fields: [calendarEventId], references: [id], onDelete: Cascade)

  @@map("recurrence_rules")
}

model CalendarEventTemplate {
  id          String        @id @default(cuid())
  name        String
  title       String
  description String?
  category    EventCategory
  level       String        @default("both")
  color       String?
  duration    Int           @default(60)
  isAllDay    Boolean       @default(false) @map("is_all_day")
  recurrence  String?
  createdBy   String        @map("created_by")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  user        User          @relation(fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([createdBy])
  @@map("calendar_event_templates")
}

model Photo {
  id          String   @id @default(cuid())
  title       String?
  description String?
  url         String
  uploadedBy  String   @map("uploaded_by")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation("PhotoUploader", fields: [uploadedBy], references: [id], onDelete: Cascade)

  @@index([uploadedBy])
  @@index([createdAt])
  @@map("photos")
}

model Video {
  id          String   @id @default(cuid())
  title       String
  description String?
  url         String
  thumbnail   String?
  category    String?
  tags        Json?
  isPublic    Boolean  @default(false) @map("is_public")
  uploadedBy  String   @map("uploaded_by")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  uploader    User     @relation("VideoUploader", fields: [uploadedBy], references: [id], onDelete: Cascade)

  @@index([uploadedBy])
  @@index([category])
  @@index([isPublic])
  @@map("videos")
}

model VideoCapsule {
  id          String   @id @default("default-capsule")
  title       String
  description String?
  url         String
  isActive    Boolean  @default(false) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("video_capsules")
}

model Vote {
  id          String         @id @default(cuid())
  title       String
  description String?
  endDate     DateTime       @map("end_date")
  isActive    Boolean        @default(true) @map("is_active")
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @updatedAt @map("updated_at")
  options     VoteOption[]
  responses   VoteResponse[]

  @@map("votes")
}

model VoteOption {
  id        String         @id @default(cuid())
  text      String
  voteId    String         @map("vote_id")
  createdAt DateTime       @default(now()) @map("created_at")
  vote      Vote           @relation(fields: [voteId], references: [id], onDelete: Cascade)
  responses VoteResponse[]

  @@index([voteId])
  @@map("vote_options")
}

model VoteResponse {
  id        String     @id @default(cuid())
  voteId    String     @map("vote_id")
  optionId  String     @map("option_id")
  userId    String     @map("user_id")
  createdAt DateTime   @default(now()) @map("created_at")
  user      User       @relation("UserVotes", fields: [userId], references: [id], onDelete: Cascade)
  option    VoteOption @relation(fields: [optionId], references: [id], onDelete: Cascade)
  vote      Vote       @relation(fields: [voteId], references: [id], onDelete: Cascade)

  @@unique([voteId, userId])
  @@index([voteId])
  @@index([optionId])
  @@index([userId])
  @@map("vote_responses")
}

enum UserRole {
  ADMIN
  PROFESOR
  PARENT
  PUBLIC
}

enum UserStatus {
  PENDING
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum EventCategory {
  ACADEMIC
  HOLIDAY
  SPECIAL
  PARENT
  ADMINISTRATIVE
  EXAM
  MEETING
  VACATION
  EVENT
  DEADLINE
  OTHER
}

enum EventPriority {
  LOW
  MEDIUM
  HIGH
}

enum RecurrencePattern {
  NONE
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
  CUSTOM
}

enum Day {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum MeetingStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum MeetingType {
  PARENT_TEACHER
  FOLLOW_UP
  EMERGENCY
  IEP_REVIEW
  GRADE_CONFERENCE
}

enum MeetingSource {
  STAFF_CREATED
  PARENT_REQUESTED
}